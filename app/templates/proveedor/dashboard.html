{% extends "base.html" %} {% block content %}
<style>
    body {
        /* Fondo degradado sutil para toda la página */
        background: linear-gradient(135deg, #f5faff 0%, #e3e9f7 100%);
        min-height: 100vh;
        position: relative;
    }
    /* Figuras decorativas flotantes */
    
    .bg-shape-1,
    .bg-shape-2,
    .bg-shape-3 {
        position: fixed;
        z-index: 0;
        opacity: 0.13;
        pointer-events: none;
        filter: blur(2px);
        border-radius: 50%;
        animation: float 12s ease-in-out infinite alternate;
    }
    
    .bg-shape-1 {
        width: 340px;
        height: 340px;
        background: radial-gradient(circle at 30% 30%, #0d6efd 60%, #fff0 100%);
        top: -80px;
        left: -120px;
        animation-delay: 0s;
    }
    
    .bg-shape-2 {
        width: 220px;
        height: 220px;
        background: radial-gradient(circle at 70% 70%, #ffc107 60%, #fff0 100%);
        bottom: 60px;
        right: -80px;
        animation-delay: 2s;
    }
    
    .bg-shape-3 {
        width: 160px;
        height: 160px;
        background: radial-gradient(circle at 50% 50%, #0dcaf0 60%, #fff0 100%);
        top: 60%;
        left: 60%;
        animation-delay: 4s;
    }
    
    @keyframes float {
        0% {
            transform: translateY(0) scale(1);
        }
        100% {
            transform: translateY(30px) scale(1.08);
        }
    }
    
    .proveedor-banner {
        background: linear-gradient(90deg, #0d6efd 0%, #0c3066 100%);
        color: #fff;
        border-radius: 0 0 48px 48px;
        padding: 48px 32px 64px 32px;
        margin-bottom: -40px;
        box-shadow: 0 8px 32px #0d6efd22;
        position: relative;
        overflow: hidden;
        z-index: 1;
    }
    
    .proveedor-banner .banner-title {
        font-size: 2.5rem;
        font-weight: 800;
        letter-spacing: 1.5px;
        margin-bottom: 0.5rem;
        text-shadow: 0 2px 12px #0003;
    }
    
    .proveedor-banner .banner-sub {
        font-size: 1.2rem;
        opacity: 0.96;
        margin-bottom: 0;
        font-weight: 400;
        letter-spacing: 0.5px;
    }
    
    .banner-svg-bottom {
        position: absolute;
        left: 0;
        bottom: 0;
        width: 100%;
        height: 60px;
        z-index: 2;
        pointer-events: none;
    }
    
    .logout-btn-top {
        position: absolute;
        top: 24px;
        right: 32px;
        z-index: 10;
    }
    
    @media (max-width: 600px) {
        .proveedor-banner {
            padding: 32px 10px 48px 10px;
            border-radius: 0 0 28px 28px;
        }
        .proveedor-banner .banner-title {
            font-size: 1.5rem;
        }
        .logout-btn-top {
            top: 12px;
            right: 12px;
        }
    }
</style>
<div class="bg-shape-1"></div>
<div class="bg-shape-2"></div>
<div class="bg-shape-3"></div>
<div class="proveedor-banner text-center mb-0 position-relative">
    <a href="{{ url_for('auth.logout') }}" class="btn btn-outline-light logout-btn-top rounded-pill fw-semibold shadow-sm">
        <i class="bi bi-box-arrow-right"></i> Cerrar sesión
    </a>
    <div class="banner-title">{{ current_user.nombre }}</div>
    <div class="banner-sub">Bienvenido a tu panel de proveedor. Gestiona tus productos y ventas fácilmente.</div>
    <!-- SVG decorativo inferior -->
    <svg class="banner-svg-bottom" viewBox="0 0 1440 60" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path fill="#fff" fill-opacity="1" d="M0,32 C360,80 1080,0 1440,48 L1440,60 L0,60 Z"></path>
    </svg>
</div>
<div class="container mt-5 pt-3">
    <!-- Estadísticas rápidas -->
    <div class="row mb-4 g-3">
        <div class="col-md-3">
            <div class="card border-0 shadow-sm rounded-4 text-center py-3">
                <div class="mb-2"><i class="bi bi-box-seam text-primary" style="font-size:2em;"></i></div>
                <div class="fw-bold fs-4">{{ productos|length }}</div>
                <div class="text-muted small">Productos publicados</div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card border-0 shadow-sm rounded-4 text-center py-3">
                <div class="mb-2"><i class="bi bi-receipt text-success" style="font-size:2em;"></i></div>
                <div class="fw-bold fs-4">{{ ordenes|length }}</div>
                <div class="text-muted small">Órdenes recientes</div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card border-0 shadow-sm rounded-4 text-center py-3">
                <div class="mb-2"><i class="bi bi-cash-coin text-warning" style="font-size:2em;"></i></div>
                <div class="fw-bold fs-4">
                    ${{ '{:,.2f}'.format(ventas_recientes) }}
                </div>
                <div class="text-muted small">Ventas recientes</div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card border-0 shadow-sm rounded-4 text-center py-3">
                <div class="mb-2"><i class="bi bi-star-half text-info" style="font-size:2em;"></i></div>
                <div class="fw-bold fs-4">
                    {% if valoracion_promedio is defined %} {{ '{:.1f}'.format(valoracion_promedio) }} {% else %} N/A {% endif %}
                </div>
                <div class="text-muted small">Valoración promedio</div>
            </div>
        </div>
    </div>
    <div class="row g-4">
        <!-- Productos -->
        <div class="col-lg-8">
            <div class="card shadow-lg border-0 rounded-4 mb-4">
                <div class="card-header bg-primary text-white rounded-top-4 fw-bold d-flex justify-content-between align-items-center">
                    <span><i class="bi bi-box-seam me-2"></i>Mis Productos</span>
                    <a href="{{ url_for('proveedor.nuevo_producto') }}" class="btn btn-light btn-sm rounded-pill fw-semibold shadow-sm">
                        <i class="bi bi-plus-circle"></i> Nuevo Producto
                    </a>
                </div>
                <div class="card-body bg-white">
                    {% if productos %}
                    <div class="row">
                        {% for producto in productos %}
                        <div class="col-md-6 mb-4">
                            <div class="card h-100 border-0 shadow-sm rounded-4">
                                {% if producto.imagen_url and (producto.imagen_url.startswith('http://') or producto.imagen_url.startswith('https://')) %}
                                <img src="{{ producto.imagen_url }}" alt="{{ producto.nombre }}" class="card-img-top rounded-top-4" style="height:140px; object-fit:cover;"> {% elif producto.imagen_url %}
                                <img src="{{ url_for('static', filename='img_productos/' ~ producto.imagen_url) }}" alt="{{ producto.nombre }}" class="card-img-top rounded-top-4" style="height:140px; object-fit:cover;"> {% else %}
                                <img src="{{ url_for('static', filename='default-product.png') }}" alt="Sin imagen" class="card-img-top rounded-top-4" style="height:140px; object-fit:cover;"> {% endif %}
                                <div class="card-body">
                                    <h5 class="fw-bold mb-1 text-primary">{{ producto.nombre }}</h5>
                                    <p class="text-muted small mb-2">{{ producto.descripcion }}</p>
                                    <div class="mb-1">
                                        <span class="fw-semibold">Precio sugerido venta:</span>
                                        <span class="text-primary">${{ '{:,.2f}'.format(producto.precio) }}</span>
                                    </div>
                                    <div class="mb-1">
                                        <span class="fw-semibold">Precio proveedor:</span>
                                        <span class="text-success">${{ '{:,.2f}'.format(producto.precio * Decimal('0.7')) }}</span>
                                        <span class="badge bg-light text-secondary ms-1">-30%</span>
                                    </div>
                                    <div class="mb-2">
                                        <span class="fw-semibold">Stock:</span>
                                        <span class="badge bg-info text-dark">{{ producto.stock }}</span>
                                    </div>
                                    <a href="{{ url_for('proveedor.detalle_producto', producto_id=producto.id) }}" class="btn btn-info btn-sm rounded-pill mt-2 me-2">
                                        <i class="bi bi-eye"></i> Ver detalle
                                    </a>
                                    <a href="{{ url_for('proveedor.editar_producto', producto_id=producto.id) }}" class="btn btn-outline-primary btn-sm rounded-pill mt-2 me-2">
                                        <i class="bi bi-pencil"></i> Editar
                                    </a>
                                    <a href="{{ url_for('proveedor.movimientos_stock', producto_id=producto.id) }}" class="btn btn-outline-secondary btn-sm rounded-pill mt-2">
                                        <i class="bi bi-arrow-left-right"></i> Movimientos
                                    </a>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    {% else %}
                    <div class="alert alert-info mb-0">No tienes productos registrados.</div>
                    {% endif %}
                </div>
            </div>
        </div>
        <!-- Órdenes recibidas -->
        <div class="col-lg-4">
            <div class="card shadow-lg border-0 rounded-4 h-100">
                <div class="card-header bg-success text-white rounded-top-4 fw-bold d-flex align-items-center justify-content-between">
                    <span><i class="bi bi-receipt me-2"></i>Órdenes Recibidas</span>
                    <a href="{{ url_for('proveedor.ordenes') }}" class="btn btn-light btn-sm rounded-pill fw-semibold shadow-sm ms-auto">
                        <i class="bi bi-list-ul"></i> Ver todas
                    </a>
                </div>
                <div class="card-body bg-white">
                    {% if ordenes %}
                    <ul class="list-group list-group-flush">
                        {% for orden in ordenes %}
                        <li class="list-group-item d-flex justify-content-between align-items-center py-3 border-0 border-bottom">
                            <div>
                                <span class="fw-semibold text-dark">{{ orden.producto }}</span>
                                <span class="badge bg-secondary ms-2">{{ orden.cantidad }} und</span>
                                <div class="small text-muted">{{ orden.fecha.strftime('%Y-%m-%d') }}</div>
                            </div>
                            <span class="badge px-3 py-2 shadow
                                {% if orden.estado == 'aprobada' %}bg-success
                                {% elif orden.estado == 'rechazada' %}bg-danger
                                {% else %}bg-warning text-dark
                                {% endif %} rounded-pill">
                                <i class="bi bi-circle-fill me-1 small"></i>{{ orden.estado|capitalize }}
                            </span>
                        </li>
                        {% endfor %}
                    </ul>
                    {% else %}
                    <div class="alert alert-warning mb-0">No tienes órdenes recientes.</div>
                    {% endif %}
                </div>
            </div>
            <!-- Valoraciones recientes -->
            <div class="card shadow-lg border-0 rounded-4 mt-4">
                <div class="card-header bg-warning text-dark rounded-top-4 fw-bold">
                    <i class="bi bi-star-half me-2"></i>Valoraciones Recientes
                </div>
                <div class="card-body bg-white">
                    {% if valoraciones %}
                    <ul class="list-group list-group-flush">
                        {% for val in valoraciones %}
                        <li class="list-group-item d-flex justify-content-between align-items-center py-2 border-0 border-bottom">
                            <div>
                                <span class="fw-semibold">{{ val.cliente_nombre }}</span>
                                <span class="text-muted small ms-2">{{ val.fecha.strftime('%Y-%m-%d') }}</span>
                                <div class="small">{{ val.comentario }}</div>
                            </div>
                            <span class="badge bg-info text-dark fs-6">{{ val.puntaje }}/5</span>
                        </li>
                        {% endfor %}
                    </ul>
                    {% else %}
                    <div class="text-muted small">Aún no tienes valoraciones.</div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css"> {% endblock %}