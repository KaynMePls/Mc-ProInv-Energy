{% extends "base.html" %} {% block content %}
<style>
    .carrito-container {
        max-width: 950px;
        margin: 40px auto;
        background: #fff;
        border-radius: 16px;
        box-shadow: 0 4px 24px rgba(0, 0, 0, 0.09);
        padding: 38px 44px 28px 44px;
    }
    
    .carrito-title {
        font-family: 'Montserrat', Arial, sans-serif;
        font-weight: 700;
        font-size: 2.2em;
        color: #1e2a38;
        margin-bottom: 18px;
        letter-spacing: 1px;
    }
    
    .carrito-table th {
        background: #f0f4f8;
        color: #222;
        font-weight: 700;
        border-bottom: 2px solid #eaeaea;
    }
    
    .carrito-table td,
    .carrito-table th {
        vertical-align: middle;
        padding: 13px 10px;
    }
    
    .carrito-table tr {
        transition: background 0.2s;
    }
    
    .carrito-table tr:hover {
        background: #f8fafc;
    }
    
    .badge {
        font-size: 1em;
        padding: 6px 18px;
        border-radius: 16px;
        font-weight: 600;
        letter-spacing: 0.5px;
    }
    
    .badge.bg-warning {
        background: #ffe9a7;
        color: #b48a00;
    }
    
    .badge.bg-success {
        background: #d4f8e8;
        color: #1e7e34;
    }
    
    .badge.bg-danger {
        background: #ffd6d6;
        color: #c82333;
    }
    
    .btn-volver,
    .btn-cotizar {
        margin-top: 24px;
        padding: 12px 32px;
        border-radius: 8px;
        background: #2f8f9d;
        color: #222;
        text-decoration: none;
        font-weight: 600;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
        transition: background 0.2s;
        display: inline-block;
        border: none;
    }
    
    .btn-volver:hover,
    .btn-cotizar:hover {
        background: #d1e7fd;
        color: #0d6efd;
    }
    
    .btn-comprar {
        background: #0d6efd;
        color: #fff;
        border: none;
        border-radius: 8px;
        padding: 12px 32px;
        font-weight: 600;
        text-decoration: none;
        transition: background 0.2s;
        margin-left: 10px;
        margin-top: 24px;
    }
    
    .btn-comprar:hover {
        background: #084298;
        color: #fff;
    }
    
    .total-box {
        background: #f8fafc;
        border-radius: 10px;
        padding: 18px 24px;
        margin-bottom: 18px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .total-box h4 {
        margin: 0;
        font-size: 1.3em;
        color: #1e2a38;
    }
    
    .total-items {
        color: #888;
        font-size: 1.1em;
        margin-left: 18px;
    }
    
    .table-responsive {
        margin-bottom: 32px;
    }
    
    .img-thumb {
        width: 60px;
        height: 60px;
        object-fit: cover;
        border-radius: 8px;
        border: 1px solid #eee;
        background: #f4f4f4;
    }
    
    .alert {
        margin-bottom: 24px;
    }
</style>
<div class="carrito-container">
    <div class="carrito-title">üõí Carrito de compras</div>

    {% with messages = get_flashed_messages(with_categories=true) %} {% if messages %} {% for category, message in messages %}
    <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
        {{ message }}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
    {% endfor %} {% endif %} {% endwith %} {% set total_items = 0 %} {% if productos %}
    <h4 class="mb-3">Productos en el carrito</h4>
    <div class="table-responsive">
        <table class="table carrito-table">
            <thead>
                <tr>
                    <th>Producto</th>
                    <th>Imagen</th>
                    <th>Precio</th>
                    <th>Cantidad</th>
                    <th>Subtotal</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody>
                {% for item in productos %} {% set total_items = total_items + item.cantidad %}
                <tr>
                    <td>{{ item.nombre }}</td>
                    <td>
                        {% if item.imagen_url %}
                        <img src="{{ item.imagen_url }}" alt="{{ item.nombre }}" class="img-thumb"> {% else %}
                        <span class="text-muted">Sin imagen</span> {% endif %}
                    </td>
                    <td>${{ item.precio|miles }}</td>
                    <td>
                        <form method="POST" action="{{ url_for('cliente.editar_cantidad_producto') }}" class="d-inline">
                            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                            <input type="hidden" name="producto_id" value="{{ item.id }}">
                            <input type="number" name="cantidad" value="{{ item.cantidad }}" min="1" style="width:60px;" class="form-control d-inline">
                            <button class="btn btn-sm btn-outline-primary" type="submit" title="Actualizar cantidad">‚Üª</button>
                        </form>
                    </td>
                    <td>${{ item.subtotal|miles }}</td>
                    <td>
                        <form method="POST" action="{{ url_for('cliente.quitar_producto_carrito') }}" onsubmit="return confirm('¬øSeguro que deseas quitar este producto?');">
                            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                            <input type="hidden" name="producto_id" value="{{ item.id }}">
                            <button class="btn btn-sm btn-danger">Quitar</button>
                        </form>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% endif %} {% if servicios %}
    <h4 class="mb-3 mt-4">Servicios en el carrito</h4>
    <div class="table-responsive">
        <table class="table carrito-table">
            <thead>
                <tr>
                    <th>Servicio</th>
                    <th>Descripci√≥n</th>
                    <th>Imagen</th>
                    <th>Precio</th>
                    <th>Cantidad</th>
                    <th>Subtotal</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody>
                {% for item in servicios %} {% set total_items = total_items + item.cantidad %}
                <tr>
                    <td>{{ item.nombre }}</td>
                    <td>{{ item.descripcion }}</td>
                    <td>
                        {% if item.imagen_url %}
                        <img src="{{ item.imagen_url }}" alt="{{ item.nombre }}" class="img-thumb"> {% else %}
                        <span class="text-muted">Sin imagen</span> {% endif %}
                    </td>
                    <td>${{ item.precio|miles }}</td>
                    <td>
                        <form method="POST" action="{{ url_for('cliente.editar_cantidad_servicio') }}" class="d-inline">
                            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                            <input type="hidden" name="servicio_id" value="{{ item.id }}">
                            <input type="number" name="cantidad" value="{{ item.cantidad }}" min="1" style="width:60px;" class="form-control d-inline">
                            <button class="btn btn-sm btn-outline-primary" type="submit" title="Actualizar cantidad">‚Üª</button>
                        </form>
                    </td>
                    <td>${{ item.subtotal|miles }}</td>
                    <td>
                        <form method="POST" action="{{ url_for('cliente.quitar_servicio_carrito') }}" onsubmit="return confirm('¬øSeguro que deseas quitar este servicio?');">
                            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                            <input type="hidden" name="servicio_id" value="{{ item.id }}">
                            <button class="btn btn-sm btn-danger">Quitar</button>
                        </form>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% endif %} {% if not productos and not servicios %}
    <p class="text-muted" style="font-size:1.1em;">El carrito est√° vac√≠o.</p>
    {% endif %}

    <div class="total-box mt-4">
        <h4>Total a pagar: ${{ total|miles }}</h4>
        <span class="total-items">Total de √≠tems: {{ total_items }}</span>
    </div>
    <div class="d-flex flex-wrap gap-2">
        {% if productos or servicios %}
        <form method="POST" action="{{ url_for('cliente.checkout') }}">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <button class="btn-comprar">Comprar ahora</button>
        </form>
        <form method="POST" action="{{ url_for('cliente.solicitar_cotizacion') }}">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <button class="btn-cotizar">Solicitar cotizaci√≥n</button>
        </form>
        <a href="{{ url_for('cliente.dashboard') }}" class="btn-volver">‚Üê Seguir comprando</a> {% endif %}
        <a href="{{ url_for('cliente.dashboard') }}" class="btn btn-secondary ms-2" style="margin-top:24px; border-radius:8px;">Regresar al Inicio</a>
    </div>
</div>
{% endblock %}